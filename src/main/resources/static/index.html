<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" type="text/css" href="./css/index.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
	integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
	crossorigin="anonymous">

<link rel="stylesheet" href="./css/main.css" />

<!-- Calendar -->
<link rel="stylesheet"
	href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">

<!-- Charting -->
<script type="text/javascript"
	src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.1.4/Chart.min.js"></script>

<style>
#panel, #flip {
	padding: 5px;
	text-align: center;
	background-color: #e5eecc;
	border: solid 1px #c3c3c3;
}

#panel {
	padding: 50px;
	displey: none;
}
</style>


</head>

<body role="document">

	<!-- Fixed navbar -->
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Webdino!</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="#">Home</a></li>
					<li><a href="#about">About</a></li>
				</ul>
			</div>
			<!--/.nav-collapse -->
		</div>
	</nav>

	<div class="container" role="main">

		<div class="jumbotron">
			<h1>
				Welcome to WebDino! <img src="CuteDino.png" style="width: 133px;">
			</h1>
		</div>

		<div class="panel-group">

			<div class="panel panel-info">

				<div class="panel-heading">
					<h4 class="panel-title">
						<a data-toggle="collapse" href="#collapse1">Collapsible</a>
					</h4>
				</div>

				<div id="collapse1" class="panel-collapse collapse">

					<div id="url">
						URL <input type="radio" name="prefixHTTP" value="HTTP://" checked>
						HTTP:// <input type="radio" id="prefixHTTPS" value="HTTPS://">
						HTTPS:// <input type="text" id="urlInput"
							placeholder="Enter URL Here">
						<button type="button" id="addButton" class="btn btn-primary">ADD</button>
					</div>
					<br>

					<table>
						<col width="300">
						<col width="300">
						<tr id="tableHeading">
							<th>Start Date:</th>
							<th>End Date:</th>
							<th>Interval:</th>
						</tr>

						<tr id="tableInput">
							<td><input type="text" id="startDate" class="date"></td>
							<td><input type="text" id="endDate" class="date"></td>
							<td><input type="text" id="hourInterval"
								placeholder="Hour(s)"> <input type="text"
								id="minuteInterval" placeholder="Minute(s)"> <input
								type="text" id="secondInterval" placeholder="Second(s)">
							</td>

						</tr>

					</table>


				</div>
			</div>
		</div>

		<div class="panel panel-success" id="resultPanel">

			<div class=panel-body>
				<div id="simpleUrl" class="col col-md-6">Url</div>
				<div id="simpleProgress" class="col col-md-6">In Queue</div>
			</div>
			<div class=panel-footer>

				<table>
					<tr>
						<th>Time to First Byte:</th>
						<th>Time to Full Load:</th>
						<th>Date of Initial Request:</th>

					</tr>

					<tr>
						<td id="simpleTTFB">Time</td>
						<td id="simpleFullLoad">Time</td>
						<td id="simpleDate">Some Date</td>

					</tr>

				</table>
			</div>

		</div>


		<div class="panel panel-warning" id="largeResultPanel">

			<div class=panel-body id="resultPanel">
				<div id="complexUrl" class="col col-md-6">Url</div>
				<div id="complexProgress" class="col col-md-6">In Queue</div>
			</div>
			<div class=panel-footer>

				<table>
					<tr>
						<th>Average Time to First Byte:</th>
						<th>Average Time to Full Load:</th>
						<th>Time to First Byte:</th>
						<th>Time to Full Load:</th>
					</tr>

					<tr>
						<td>5 Seconds</td>
						<td>10 Seconds</td>
						<td>6 Seconds</td>
						<td>12 Seconds</td>

					</tr>

					<tr>
						<th>Date of Initial Request:</th>
						<th>Ending Date:</th>
						<th>Interval:</th>
						<th>Iterations Completed:</th>
					</tr>

					<tr>
						<td>Yea first date</td>
						<td>ooh second date</td>
						<td>6 hours</td>
						<td>27</td>

					</tr>

				</table>
				<style>
#panel, #flip {
	padding: 5px;
	text-align: center;
	background-color: #e5eecc;
	border: solid 1px #c3c3c3;
}

#panel {
	padding: 50px;
	displey: none;
}
</style>



			</div>

		</div>

	</div>

	<!-- jQuery -->
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

	<!-- Latest compiled and minified JavaScript -->
	<script
		src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
		integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
		crossorigin="anonymous">
		
	</script>

	<!-- calendar -->
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	<!-- charting -->
	<script src="https://www.gstatic.com/charts/loader.js"></script>


	<script>
		//$(document).getElementsById("simpleTTFB")[0].value = "boo";
		//$("#simpleTTFB").val() = "bam";
		var CONST_INTERVAL = 5000;
		var jobList = new Map();

		var simpleTTFB = $("#urlInput").val();
		function updateStatusCode(){
            $.ajax({
                url : "http://localhost:8080/webdino/job/ttfb",
                type : "GET",
                data : {
                    'url' : url,
                    'name' : url,
                    'mock' : "true"
                },
                success : function(result) {
                    //Create javascript object appending functionality
                    console.log("result: " + result);
                    return result;
                },
                error : function() {
                    console.log("Unable to add Job for: " + url);
                }
            });         
        }
		function addJob() {

			var url = $("#urlInput").val();

			console.log("Adding job for URL: " + url);

			$.ajax({
				url : "http://localhost:8080/webdino/job/",
				type : "POST",
				data : {
					'url' : url,
					'name' : url,
					'mock' : "true"
				},
				success : function(result) {
					//Create javascript object appending functionality
					var job = {
						name : result.name,
						ttfb : result.firstByte,
						loadtime : result.loadTime,
						statusNum : result.statusCode,
						intervalRef : null,
						startInterval : function() {
							this.intervalRef = setInterval(function() {
								console.log("running");
								//console.log(job.runner);
								console.log(job.statusNum);
								//console.log("status: "+ job.runner);
								$.ajax({
                						url : "http://localhost:8080/webdino/job/ttfb",
                						type : "GET",
                						data : {
                   							'url' : url,
                    						'name' : url,
                    						'mock' : "true"
                						},
                						success : function(result) {
                    						//Create javascript object appending functionality
                    						
                    						console.log("result: " + result);
                    						console.log("statusNum: " + job.statusNum);
                    						
                    						if("200" == result){
                    							$.ajax({
                            						url : "http://localhost:8080/webdino/job/output",
                            						type : "GET",
                            						data : {
                               							'url' : url,
                                						'name' : url,
                                						'mock' : "true"
                            						},success : function(result){
                            							var answer ={
                            									name : result.name,
                            									ttfb : result.firstByte,
                            									loadtime : result.loadTime,
                            									statusNum : result.statusCode
                            							}
		                    							console.log("complete " + answer.ttfb + "!");
		            									$("#simpleTTFB").text(answer.ttfb);
		            									$("#simpleFullLoad").text(answer.loadtime);
		            									//$("#simpleDate").text(job.ttfb);
		            									$("#simpleUrl").text(answer.name);
		            									$("#simpleProgress").text("Completed");
		                    							job.stopInterval();
                            						},
                            						error : function(){
                                						console.log("Unable to get final informations for: " + url);
                            						}
                            					});
                    						}
                    						//return result;
                						},
               							error : function() {
                    						console.log("Unable to add Job for: " + url);
                						}
            					});
							
								if ("101" == job.statusNum) {
									$("#simpleProgress").text("Testing");
								} 
								else if ("100" == job.statusNum) {
									$("#simpleProgress").text("In Queue");
								} 
								else{
									console.log(job.statusNum);
									console.log("Error");
								}

								console.log(job.name);
								console.log("-----------------");
							}, CONST_INTERVAL);
						},
						stopInterval : function() {
							clearInterval(this.intervalRef);
						}
					}
					
					//Begin interval
					job.startInterval();
					console.log("stuu " + job.ttfb);
					jobList.set(result.name, job);

				},
				error : function() {
					console.log("Unable to add Job for: " + url);
				}
			});

		}

		$(document).ready(function() {

			//Calendar code
			$(function() {
				$("#startDate").datepicker();
			});

			$(function() {
				$("#endDate").datepicker();
			});

			$("#addButton").click(function() {
				addJob();
			});

		});
	</script>

</body>
</html>
